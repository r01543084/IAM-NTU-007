%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%                                                                         %
%               WENO3   5th order                                         %
%                      Atmosphere@ntu 2013.12.2                           %
%                                   thanks Tony                           %
%                                                                         %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
function [fout] = weno3(f)
%%
%beta is the same!!
beta(1) = 1/3*(4*f(1)^2-19*f(1)*f(2)+25*f(2)^2 ...
              +11*f(1)*f(3)-31*f(2)*f(3)+10*f(3)^2);
              
beta(2) = 1/3*(4*f(2)^2-13*f(2)*f(3)+13*f(3)^2 ...
              +5*f(2)*f(4)-13*f(3)*f(4)+4*f(4)^2);
              
beta(3) = 1/3*(10*f(3)^2-31*f(3)*f(4)+25*f(4)^2 ...
              +11*f(3)*f(5)-19*f(4)*f(5)+4*f(5)^2);
epsilon = 10^-6;%5th order = 10^-(order+1)
%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%   right hand side  %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%                                 |         |                              
%------------------o---------o----|----o----|----o---------o---------------
%                 i-2       i-1   |    i    |   i+1       i+2
%                                 |         |                              
%                                         -                        
%                                        u
%                                         i+1/2                            
gammaR = [1/16 5/8 5/16];
wR = (gammaR./(epsilon+beta).^2)/sum(gammaR./(epsilon+beta).^2);
foutR = [3/8*f(1)-5/4*f(2)+15/8*f(3) ...
        -1/8*f(2)+3/4*f(3)+3/8*f(4) ...
         3/8*f(3)+3/4*f(4)-1/8*f(5)]*wR';

%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%   right hand side  %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%                                 |         |                              
%------------------o---------o----|----o----|----o---------o---------------
%                 i-2       i-1   |    i    |   i+1       i+2
%                                 |         |                              
%                                  +                        
%                                 u
%                                  i-1/2                            
gammaL = [5/16 5/8 1/16];
wL = (gammaL./(epsilon+beta).^2)/sum(gammaL./(epsilon+beta).^2);
foutL = [-1/8*f(1)+3/4*f(2)+3/8*f(3) ...
          3/8*f(2)+3/4*f(3)-1/8*f(4) ...
         15/8*f(3)-5/4*f(4)+3/8*f(5)]*wL';
fout = [foutR;foutL];